name: Integration Test

on:
  workflow_run:
      workflows: ["DB12 Testing"]
      types: 
        - completed

jobs:
  build:
    runs-on: ubuntu-latest

    steps:  
    - uses: actions/checkout@v2
    - name: Set up Python
      uses: actions/setup-python@v2
    
    - uses: dawidd6/action-download-artifact@v2
      with:
        workflow: python2-3-app.yml
        name: Integration test
    
    - name: Comparing results
      shell: bash
      run: | 
        result1=$(cat result_python3.6.txt)
        result2=$(cat result_python3.9.txt)
        result3=$(cat result_python2.7.txt)
        
        threshold=$(awk '{print $1/$2}' <<< "20 100")
        product=$(awk '{print $1*$2}' <<< "$result3 $threshold")
        
        difference1=$(awk '{print $1-$2}' <<< "$result1 $result3")
        difference2=$(awk '{print $1-$2}' <<< "$result2 $result3")
        
        #Seeing if the difference between the results is less than the allowed threshold
        
        if [${difference1#-} -gt ${th}]
          then
            echo "yes"
          else
            echo "no"
        fi
        
        if [${difference2#-} -gt ${th}]
          then
            echo "yes"
          else
            echo "no"
        fi
